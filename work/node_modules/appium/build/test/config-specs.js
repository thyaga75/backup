require('source-map-support').install();

'use strict';

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _libConfig = require('../lib/config');

var _libParser = require('../lib/parser');

var _libParser2 = _interopRequireDefault(_libParser);

var _libLogger = require('../lib/logger');

var _libLogger2 = _interopRequireDefault(_libLogger);

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('Config', function () {
  describe('getGitRev', function () {
    it('should get a reasonable git revision', function callee$2$0() {
      var rev;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _libConfig.getGitRev)());

          case 2:
            rev = context$3$0.sent;

            rev.should.be.a('string');
            rev.length.should.be.equal(40);
            rev.match(/[0-9a-f]+/i)[0].should.eql(rev);

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('Appium config', function () {
    describe('getAppiumConfig', function () {
      it('should get a configuration object', function callee$3$0() {
        var config;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _libConfig.getAppiumConfig)());

            case 2:
              config = context$4$0.sent;

              config.should.be.an('object');
              should.exist(config['git-sha']);
              should.exist(config.built);
              should.exist(config.version);

            case 7:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
    describe('showConfig', function () {
      before(function () {
        _sinon2['default'].spy(console, "log");
      });
      it('should log the config to console', function callee$3$0() {
        var config;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _libConfig.getAppiumConfig)());

            case 2:
              config = context$4$0.sent;
              context$4$0.next = 5;
              return _regeneratorRuntime.awrap((0, _libConfig.showConfig)());

            case 5:
              console.log.calledOnce.should.be['true'];
              console.log.getCall(0).args[0].should.contain(JSON.stringify(config));

            case 7:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
  });

  describe('node.js config', function () {
    var _process = process;
    before(function () {
      // need to be able to write to process.version
      // but also to have access to process methods
      // so copy them over to a writable object
      var tempProcess = {};
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = _getIterator(_lodash2['default'].pairs(process)), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var _step$value = _slicedToArray(_step.value, 2);

          var prop = _step$value[0];
          var value = _step$value[1];

          tempProcess[prop] = value;
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator['return']) {
            _iterator['return']();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      process = tempProcess;
    });
    after(function () {
      process = _process;
    });
    describe('checkNodeOk', function () {
      it('should fail if node is below 0.10', function () {
        process.version = 'v0.9.12';
        _libConfig.checkNodeOk.should['throw'];
      });
      it('should succeed if node is 0.10+', function () {
        process.version = 'v0.10.0';
        _libConfig.checkNodeOk.should.not['throw'];
      });
      it('should succeed if node is 1.x', function () {
        process.version = 'v1.0.0';
        _libConfig.checkNodeOk.should.not['throw'];
      });
    });

    describe('warnNodeDeprecations', function () {
      var spy = undefined;
      before(function () {
        spy = _sinon2['default'].spy(_libLogger2['default'], "warn");
      });
      beforeEach(function () {
        spy.reset();
      });
      it('should log a warning if node is below 0.12', function () {
        process.version = 'v0.9.12';
        (0, _libConfig.warnNodeDeprecations)();
        _libLogger2['default'].warn.callCount.should.equal(1);
      });
      it('should not log a warning if node is 0.12+', function () {
        process.version = 'v0.12.0';
        (0, _libConfig.warnNodeDeprecations)();
        _libLogger2['default'].warn.callCount.should.equal(0);
      });
      it('should not log a warning if node is 1.x', function () {
        process.version = 'v1.0.0';
        (0, _libConfig.warnNodeDeprecations)();
        _libLogger2['default'].warn.callCount.should.equal(0);
      });
    });
  });

  describe('server arguments', function () {
    var parser = (0, _libParser2['default'])();
    var args = {};
    beforeEach(function () {
      // give all the defaults
      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = _getIterator(parser.rawArgs), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          var rawArg = _step2.value;

          args[rawArg[1].dest] = rawArg[1].defaultValue;
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2['return']) {
            _iterator2['return']();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }
    });
    describe('getNonDefaultArgs', function () {
      it('should show none if we have all the defaults', function () {
        var nonDefaultArgs = (0, _libConfig.getNonDefaultArgs)(parser, args);
        _lodash2['default'].keys(nonDefaultArgs).length.should.equal(0);
      });
      it('should catch a non-default argument', function () {
        args.isolateSimDevice = true;
        var nonDefaultArgs = (0, _libConfig.getNonDefaultArgs)(parser, args);
        _lodash2['default'].keys(nonDefaultArgs).length.should.equal(1);
        should.exist(nonDefaultArgs.isolateSimDevice);
      });
    });

    describe('getDeprecatedArgs', function () {
      it('should show none if we have no deprecated arguments', function () {
        var deprecatedArgs = (0, _libConfig.getDeprecatedArgs)(parser, args);
        _lodash2['default'].keys(deprecatedArgs).length.should.equal(0);
      });
      it('should catch a deprecated argument', function () {
        args.showIOSLog = true;
        var deprecatedArgs = (0, _libConfig.getDeprecatedArgs)(parser, args);
        _lodash2['default'].keys(deprecatedArgs).length.should.equal(1);
        should.exist(deprecatedArgs['--show-ios-log']);
      });
      it('should catch a non-boolean deprecated argument', function () {
        args.calendarFormat = 'orwellian';
        var deprecatedArgs = (0, _libConfig.getDeprecatedArgs)(parser, args);
        _lodash2['default'].keys(deprecatedArgs).length.should.equal(1);
        should.exist(deprecatedArgs['--calendar-format']);
      });
    });
  });

  describe('checkValidPort', function () {
    it('should be false for port too high', function () {
      (0, _libConfig.checkValidPort)(65536).should.be['false'];
    });
    it('should be false for port too low', function () {
      (0, _libConfig.checkValidPort)(0).should.be['false'];
    });
    it('should be true for port 1', function () {
      (0, _libConfig.checkValidPort)(1).should.be['true'];
    });
    it('should be true for port 65535', function () {
      (0, _libConfig.checkValidPort)(65535).should.be['true'];
    });
  });

  describe('validateTmpDir', function () {
    it('should fail to use a tmp dir with incorrect permissions', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            (0, _libConfig.validateTmpDir)('/private/if_you_run_with_sudo_this_wont_fail').should.be.rejectedWith(/could not ensure/);

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should fail to use an undefined tmp dir', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            (0, _libConfig.validateTmpDir)().should.be.rejectedWith(/could not ensure/);

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should be able to use a tmp dir with correct permissions', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            (0, _libConfig.validateTmpDir)('/tmp/test_tmp_dir/with/any/number/of/levels').should.not.be.rejected;

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('validateServerArgs', function () {
    var parser = (0, _libParser2['default'])();
    describe('mutually exclusive server arguments', function () {
      describe('noReset and fullReset', function () {
        it('should not allow both', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { noReset: true, fullReset: true });
          }).should['throw'];
        });
        it('should allow noReset', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { noReset: true });
          }).should.not['throw'];
        });
        it('should allow fullReset', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { fullReset: true });
          }).should.not['throw'];
        });
      });
      describe('ipa and safari', function () {
        it('should not allow both', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { ipa: true, safari: true });
          }).should['throw'];
        });
        it('should allow ipa', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { ipa: true });
          }).should.not['throw'];
        });
        it('should allow safari', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { safari: true });
          }).should.not['throw'];
        });
      });
      describe('app and safari', function () {
        it('should not allow both', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { app: true, safari: true });
          }).should['throw'];
        });
        it('should allow app', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { app: true });
          }).should.not['throw'];
        });
      });
      describe('forceIphone and forceIpad', function () {
        it('should not allow both', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { forceIphone: true, forceIpad: true });
          }).should['throw'];
        });
        it('should allow forceIphone', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { forceIphone: true });
          }).should.not['throw'];
        });
        it('should allow forceIpad', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { forceIpad: true });
          }).should.not['throw'];
        });
      });
      describe('deviceName and defaultDevice', function () {
        it('should not allow both', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { deviceName: true, defaultDevice: true });
          }).should['throw'];
        });
        it('should allow deviceName', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { deviceName: true });
          }).should.not['throw'];
        });
        it('should allow defaultDevice', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { defaultDevice: true });
          }).should.not['throw'];
        });
      });
    });
    describe('validated arguments', function () {
      // checking ports is already done.
      // the only argument left is `backendRetries`
      describe('backendRetries', function () {
        it('should fail with value less than 0', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { backendRetries: -1 });
          }).should['throw'];
        });
        it('should succeed with value of 0', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { backendRetries: 0 });
          }).should.not['throw'];
        });
        it('should succeed with value above 0', function () {
          (function () {
            (0, _libConfig.validateServerArgs)(parser, { backendRetries: 100 });
          }).should.not['throw'];
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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QUFDLENBQUM7S0FDSixDQUFDLENBQUM7QUFDSCxZQUFRLENBQUMscUJBQXFCLEVBQUUsWUFBTTs7O0FBR3BDLGNBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFNO0FBQy9CLFVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxZQUFNO0FBQzdDLFdBQUMsWUFBTTtBQUFDLCtDQUFtQixNQUFNLEVBQUUsRUFBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1dBQUMsQ0FBQSxDQUFFLE1BQU0sU0FBTSxDQUFDO1NBQzFFLENBQUMsQ0FBQztBQUNILFVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxZQUFNO0FBQ3pDLFdBQUMsWUFBTTtBQUFDLCtDQUFtQixNQUFNLEVBQUUsRUFBQyxjQUFjLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztXQUFDLENBQUEsQ0FBRSxNQUFNLENBQUMsR0FBRyxTQUFNLENBQUM7U0FDN0UsQ0FBQyxDQUFDO0FBQ0gsVUFBRSxDQUFDLG1DQUFtQyxFQUFFLFlBQU07QUFDNUMsV0FBQyxZQUFNO0FBQUMsK0NBQW1CLE1BQU0sRUFBRSxFQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDO1dBQUMsQ0FBQSxDQUFFLE1BQU0sQ0FBQyxHQUFHLFNBQU0sQ0FBQztTQUMvRSxDQUFDLENBQUM7T0FDSixDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9jb25maWctc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB7IGdldEdpdFJldiwgZ2V0QXBwaXVtQ29uZmlnLCBjaGVja05vZGVPaywgd2Fybk5vZGVEZXByZWNhdGlvbnMsXG4gICAgICAgICBnZXROb25EZWZhdWx0QXJncywgZ2V0RGVwcmVjYXRlZEFyZ3MsIHZhbGlkYXRlU2VydmVyQXJncyxcbiAgICAgICAgIHZhbGlkYXRlVG1wRGlyLCBzaG93Q29uZmlnLCBjaGVja1ZhbGlkUG9ydCB9IGZyb20gJy4uL2xpYi9jb25maWcnO1xuaW1wb3J0IGdldFBhcnNlciBmcm9tICcuLi9saWIvcGFyc2VyJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbGliL2xvZ2dlcic7XG5cblxubGV0IHNob3VsZCA9IGNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cblxuZGVzY3JpYmUoJ0NvbmZpZycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ2dldEdpdFJldicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhIHJlYXNvbmFibGUgZ2l0IHJldmlzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJldiA9IGF3YWl0IGdldEdpdFJldigpO1xuICAgICAgcmV2LnNob3VsZC5iZS5hKCdzdHJpbmcnKTtcbiAgICAgIHJldi5sZW5ndGguc2hvdWxkLmJlLmVxdWFsKDQwKTtcbiAgICAgIHJldi5tYXRjaCgvWzAtOWEtZl0rL2kpWzBdLnNob3VsZC5lcWwocmV2KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FwcGl1bSBjb25maWcnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2dldEFwcGl1bUNvbmZpZycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IGEgY29uZmlndXJhdGlvbiBvYmplY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBjb25maWcgPSBhd2FpdCBnZXRBcHBpdW1Db25maWcoKTtcbiAgICAgICAgY29uZmlnLnNob3VsZC5iZS5hbignb2JqZWN0Jyk7XG4gICAgICAgIHNob3VsZC5leGlzdChjb25maWdbJ2dpdC1zaGEnXSk7XG4gICAgICAgIHNob3VsZC5leGlzdChjb25maWcuYnVpbHQpO1xuICAgICAgICBzaG91bGQuZXhpc3QoY29uZmlnLnZlcnNpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ3Nob3dDb25maWcnLCAoKSA9PiB7XG4gICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICBzaW5vbi5zcHkoY29uc29sZSwgXCJsb2dcIik7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgbG9nIHRoZSBjb25maWcgdG8gY29uc29sZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IGNvbmZpZyA9IGF3YWl0IGdldEFwcGl1bUNvbmZpZygpO1xuICAgICAgICBhd2FpdCBzaG93Q29uZmlnKCk7XG4gICAgICAgIGNvbnNvbGUubG9nLmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG4gICAgICAgIGNvbnNvbGUubG9nLmdldENhbGwoMCkuYXJnc1swXS5zaG91bGQuY29udGFpbihKU09OLnN0cmluZ2lmeShjb25maWcpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbm9kZS5qcyBjb25maWcnLCAoKSA9PiB7XG4gICAgbGV0IF9wcm9jZXNzID0gcHJvY2VzcztcbiAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgLy8gbmVlZCB0byBiZSBhYmxlIHRvIHdyaXRlIHRvIHByb2Nlc3MudmVyc2lvblxuICAgICAgLy8gYnV0IGFsc28gdG8gaGF2ZSBhY2Nlc3MgdG8gcHJvY2VzcyBtZXRob2RzXG4gICAgICAvLyBzbyBjb3B5IHRoZW0gb3ZlciB0byBhIHdyaXRhYmxlIG9iamVjdFxuICAgICAgbGV0IHRlbXBQcm9jZXNzID0ge307XG4gICAgICBmb3IgKGxldCBbcHJvcCwgdmFsdWVdIG9mIF8ucGFpcnMocHJvY2VzcykpIHtcbiAgICAgICAgdGVtcFByb2Nlc3NbcHJvcF0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHByb2Nlc3MgPSB0ZW1wUHJvY2VzcztcbiAgICB9KTtcbiAgICBhZnRlcigoKSA9PiB7XG4gICAgICBwcm9jZXNzID0gX3Byb2Nlc3M7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ2NoZWNrTm9kZU9rJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBmYWlsIGlmIG5vZGUgaXMgYmVsb3cgMC4xMCcsICgpID0+IHtcbiAgICAgICAgcHJvY2Vzcy52ZXJzaW9uID0gJ3YwLjkuMTInO1xuICAgICAgICBjaGVja05vZGVPay5zaG91bGQudGhyb3c7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgc3VjY2VlZCBpZiBub2RlIGlzIDAuMTArJywgKCkgPT4ge1xuICAgICAgICBwcm9jZXNzLnZlcnNpb24gPSAndjAuMTAuMCc7XG4gICAgICAgIGNoZWNrTm9kZU9rLnNob3VsZC5ub3QudGhyb3c7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgc3VjY2VlZCBpZiBub2RlIGlzIDEueCcsICgpID0+IHtcbiAgICAgICAgcHJvY2Vzcy52ZXJzaW9uID0gJ3YxLjAuMCc7XG4gICAgICAgIGNoZWNrTm9kZU9rLnNob3VsZC5ub3QudGhyb3c7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd3YXJuTm9kZURlcHJlY2F0aW9ucycsICgpID0+IHtcbiAgICAgIGxldCBzcHk7XG4gICAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICBzcHkgPSBzaW5vbi5zcHkobG9nZ2VyLCBcIndhcm5cIik7XG4gICAgICB9KTtcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBzcHkucmVzZXQoKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBsb2cgYSB3YXJuaW5nIGlmIG5vZGUgaXMgYmVsb3cgMC4xMicsICgpID0+IHtcbiAgICAgICAgcHJvY2Vzcy52ZXJzaW9uID0gJ3YwLjkuMTInO1xuICAgICAgICB3YXJuTm9kZURlcHJlY2F0aW9ucygpO1xuICAgICAgICBsb2dnZXIud2Fybi5jYWxsQ291bnQuc2hvdWxkLmVxdWFsKDEpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIG5vdCBsb2cgYSB3YXJuaW5nIGlmIG5vZGUgaXMgMC4xMisnLCAoKSA9PiB7XG4gICAgICAgIHByb2Nlc3MudmVyc2lvbiA9ICd2MC4xMi4wJztcbiAgICAgICAgd2Fybk5vZGVEZXByZWNhdGlvbnMoKTtcbiAgICAgICAgbG9nZ2VyLndhcm4uY2FsbENvdW50LnNob3VsZC5lcXVhbCgwKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBub3QgbG9nIGEgd2FybmluZyBpZiBub2RlIGlzIDEueCcsICgpID0+IHtcbiAgICAgICAgcHJvY2Vzcy52ZXJzaW9uID0gJ3YxLjAuMCc7XG4gICAgICAgIHdhcm5Ob2RlRGVwcmVjYXRpb25zKCk7XG4gICAgICAgIGxvZ2dlci53YXJuLmNhbGxDb3VudC5zaG91bGQuZXF1YWwoMCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NlcnZlciBhcmd1bWVudHMnLCAoKSA9PiB7XG4gICAgbGV0IHBhcnNlciA9IGdldFBhcnNlcigpO1xuICAgIGxldCBhcmdzID0ge307XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAvLyBnaXZlIGFsbCB0aGUgZGVmYXVsdHNcbiAgICAgIGZvciAobGV0IHJhd0FyZyBvZiBwYXJzZXIucmF3QXJncykge1xuICAgICAgICBhcmdzW3Jhd0FyZ1sxXS5kZXN0XSA9IHJhd0FyZ1sxXS5kZWZhdWx0VmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ2dldE5vbkRlZmF1bHRBcmdzJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBzaG93IG5vbmUgaWYgd2UgaGF2ZSBhbGwgdGhlIGRlZmF1bHRzJywgKCkgPT4ge1xuICAgICAgICBsZXQgbm9uRGVmYXVsdEFyZ3MgPSBnZXROb25EZWZhdWx0QXJncyhwYXJzZXIsIGFyZ3MpO1xuICAgICAgICBfLmtleXMobm9uRGVmYXVsdEFyZ3MpLmxlbmd0aC5zaG91bGQuZXF1YWwoMCk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgY2F0Y2ggYSBub24tZGVmYXVsdCBhcmd1bWVudCcsICgpID0+IHtcbiAgICAgICAgYXJncy5pc29sYXRlU2ltRGV2aWNlID0gdHJ1ZTtcbiAgICAgICAgbGV0IG5vbkRlZmF1bHRBcmdzID0gZ2V0Tm9uRGVmYXVsdEFyZ3MocGFyc2VyLCBhcmdzKTtcbiAgICAgICAgXy5rZXlzKG5vbkRlZmF1bHRBcmdzKS5sZW5ndGguc2hvdWxkLmVxdWFsKDEpO1xuICAgICAgICBzaG91bGQuZXhpc3Qobm9uRGVmYXVsdEFyZ3MuaXNvbGF0ZVNpbURldmljZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXREZXByZWNhdGVkQXJncycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc2hvdyBub25lIGlmIHdlIGhhdmUgbm8gZGVwcmVjYXRlZCBhcmd1bWVudHMnLCAoKSA9PiB7XG4gICAgICAgIGxldCBkZXByZWNhdGVkQXJncyA9IGdldERlcHJlY2F0ZWRBcmdzKHBhcnNlciwgYXJncyk7XG4gICAgICAgIF8ua2V5cyhkZXByZWNhdGVkQXJncykubGVuZ3RoLnNob3VsZC5lcXVhbCgwKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBjYXRjaCBhIGRlcHJlY2F0ZWQgYXJndW1lbnQnLCAoKSA9PiB7XG4gICAgICAgIGFyZ3Muc2hvd0lPU0xvZyA9IHRydWU7XG4gICAgICAgIGxldCBkZXByZWNhdGVkQXJncyA9IGdldERlcHJlY2F0ZWRBcmdzKHBhcnNlciwgYXJncyk7XG4gICAgICAgIF8ua2V5cyhkZXByZWNhdGVkQXJncykubGVuZ3RoLnNob3VsZC5lcXVhbCgxKTtcbiAgICAgICAgc2hvdWxkLmV4aXN0KGRlcHJlY2F0ZWRBcmdzWyctLXNob3ctaW9zLWxvZyddKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBjYXRjaCBhIG5vbi1ib29sZWFuIGRlcHJlY2F0ZWQgYXJndW1lbnQnLCAoKSA9PiB7XG4gICAgICAgIGFyZ3MuY2FsZW5kYXJGb3JtYXQgPSAnb3J3ZWxsaWFuJztcbiAgICAgICAgbGV0IGRlcHJlY2F0ZWRBcmdzID0gZ2V0RGVwcmVjYXRlZEFyZ3MocGFyc2VyLCBhcmdzKTtcbiAgICAgICAgXy5rZXlzKGRlcHJlY2F0ZWRBcmdzKS5sZW5ndGguc2hvdWxkLmVxdWFsKDEpO1xuICAgICAgICBzaG91bGQuZXhpc3QoZGVwcmVjYXRlZEFyZ3NbJy0tY2FsZW5kYXItZm9ybWF0J10pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGVja1ZhbGlkUG9ydCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGJlIGZhbHNlIGZvciBwb3J0IHRvbyBoaWdoJywgKCkgPT4ge1xuICAgICAgY2hlY2tWYWxpZFBvcnQoNjU1MzYpLnNob3VsZC5iZS5mYWxzZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGJlIGZhbHNlIGZvciBwb3J0IHRvbyBsb3cnLCAoKSA9PiB7XG4gICAgICBjaGVja1ZhbGlkUG9ydCgwKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBiZSB0cnVlIGZvciBwb3J0IDEnLCAoKSA9PiB7XG4gICAgICBjaGVja1ZhbGlkUG9ydCgxKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGJlIHRydWUgZm9yIHBvcnQgNjU1MzUnLCAoKSA9PiB7XG4gICAgICBjaGVja1ZhbGlkUG9ydCg2NTUzNSkuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZVRtcERpcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdXNlIGEgdG1wIGRpciB3aXRoIGluY29ycmVjdCBwZXJtaXNzaW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIHZhbGlkYXRlVG1wRGlyKCcvcHJpdmF0ZS9pZl95b3VfcnVuX3dpdGhfc3Vkb190aGlzX3dvbnRfZmFpbCcpLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoL2NvdWxkIG5vdCBlbnN1cmUvKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gdXNlIGFuIHVuZGVmaW5lZCB0bXAgZGlyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgdmFsaWRhdGVUbXBEaXIoKS5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9jb3VsZCBub3QgZW5zdXJlLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHVzZSBhIHRtcCBkaXIgd2l0aCBjb3JyZWN0IHBlcm1pc3Npb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgdmFsaWRhdGVUbXBEaXIoJy90bXAvdGVzdF90bXBfZGlyL3dpdGgvYW55L251bWJlci9vZi9sZXZlbHMnKS5zaG91bGQubm90LmJlLnJlamVjdGVkO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVTZXJ2ZXJBcmdzJywgKCkgPT4ge1xuICAgIGxldCBwYXJzZXIgPSBnZXRQYXJzZXIoKTtcbiAgICBkZXNjcmliZSgnbXV0dWFsbHkgZXhjbHVzaXZlIHNlcnZlciBhcmd1bWVudHMnLCAoKSA9PiB7XG4gICAgICBkZXNjcmliZSgnbm9SZXNldCBhbmQgZnVsbFJlc2V0JywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyBib3RoJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7bm9SZXNldDogdHJ1ZSwgZnVsbFJlc2V0OiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLnRocm93O1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBub1Jlc2V0JywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7bm9SZXNldDogdHJ1ZX0pO1xuICAgICAgICAgIH0pLnNob3VsZC5ub3QudGhyb3c7XG4gICAgICAgIH0pO1xuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IGZ1bGxSZXNldCcsICgpID0+IHtcbiAgICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgdmFsaWRhdGVTZXJ2ZXJBcmdzKHBhcnNlciwge2Z1bGxSZXNldDogdHJ1ZX0pO1xuICAgICAgICAgIH0pLnNob3VsZC5ub3QudGhyb3c7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBkZXNjcmliZSgnaXBhIGFuZCBzYWZhcmknLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgbm90IGFsbG93IGJvdGgnLCAoKSA9PiB7XG4gICAgICAgICAgKCgpID0+IHtcbiAgICAgICAgICAgIHZhbGlkYXRlU2VydmVyQXJncyhwYXJzZXIsIHtpcGE6IHRydWUsIHNhZmFyaTogdHJ1ZX0pO1xuICAgICAgICAgIH0pLnNob3VsZC50aHJvdztcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgaXBhJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7aXBhOiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLm5vdC50aHJvdztcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgc2FmYXJpJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7c2FmYXJpOiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLm5vdC50aHJvdztcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGRlc2NyaWJlKCdhcHAgYW5kIHNhZmFyaScsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgYWxsb3cgYm90aCcsICgpID0+IHtcbiAgICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgdmFsaWRhdGVTZXJ2ZXJBcmdzKHBhcnNlciwge2FwcDogdHJ1ZSwgc2FmYXJpOiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLnRocm93O1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBhcHAnLCAoKSA9PiB7XG4gICAgICAgICAgKCgpID0+IHtcbiAgICAgICAgICAgIHZhbGlkYXRlU2VydmVyQXJncyhwYXJzZXIsIHthcHA6IHRydWV9KTtcbiAgICAgICAgICB9KS5zaG91bGQubm90LnRocm93O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgZGVzY3JpYmUoJ2ZvcmNlSXBob25lIGFuZCBmb3JjZUlwYWQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgbm90IGFsbG93IGJvdGgnLCAoKSA9PiB7XG4gICAgICAgICAgKCgpID0+IHtcbiAgICAgICAgICAgIHZhbGlkYXRlU2VydmVyQXJncyhwYXJzZXIsIHtmb3JjZUlwaG9uZTogdHJ1ZSwgZm9yY2VJcGFkOiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLnRocm93O1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBmb3JjZUlwaG9uZScsICgpID0+IHtcbiAgICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgdmFsaWRhdGVTZXJ2ZXJBcmdzKHBhcnNlciwge2ZvcmNlSXBob25lOiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLm5vdC50aHJvdztcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgZm9yY2VJcGFkJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7Zm9yY2VJcGFkOiB0cnVlfSk7XG4gICAgICAgICAgfSkuc2hvdWxkLm5vdC50aHJvdztcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGRlc2NyaWJlKCdkZXZpY2VOYW1lIGFuZCBkZWZhdWx0RGV2aWNlJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyBib3RoJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7ZGV2aWNlTmFtZTogdHJ1ZSwgZGVmYXVsdERldmljZTogdHJ1ZX0pO1xuICAgICAgICAgIH0pLnNob3VsZC50aHJvdztcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgZGV2aWNlTmFtZScsICgpID0+IHtcbiAgICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgdmFsaWRhdGVTZXJ2ZXJBcmdzKHBhcnNlciwge2RldmljZU5hbWU6IHRydWV9KTtcbiAgICAgICAgICB9KS5zaG91bGQubm90LnRocm93O1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBkZWZhdWx0RGV2aWNlJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgICB2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7ZGVmYXVsdERldmljZTogdHJ1ZX0pO1xuICAgICAgICAgIH0pLnNob3VsZC5ub3QudGhyb3c7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ3ZhbGlkYXRlZCBhcmd1bWVudHMnLCAoKSA9PiB7XG4gICAgICAvLyBjaGVja2luZyBwb3J0cyBpcyBhbHJlYWR5IGRvbmUuXG4gICAgICAvLyB0aGUgb25seSBhcmd1bWVudCBsZWZ0IGlzIGBiYWNrZW5kUmV0cmllc2BcbiAgICAgIGRlc2NyaWJlKCdiYWNrZW5kUmV0cmllcycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBmYWlsIHdpdGggdmFsdWUgbGVzcyB0aGFuIDAnLCAoKSA9PiB7XG4gICAgICAgICAgKCgpID0+IHt2YWxpZGF0ZVNlcnZlckFyZ3MocGFyc2VyLCB7YmFja2VuZFJldHJpZXM6IC0xfSk7fSkuc2hvdWxkLnRocm93O1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoJ3Nob3VsZCBzdWNjZWVkIHdpdGggdmFsdWUgb2YgMCcsICgpID0+IHtcbiAgICAgICAgICAoKCkgPT4ge3ZhbGlkYXRlU2VydmVyQXJncyhwYXJzZXIsIHtiYWNrZW5kUmV0cmllczogMH0pO30pLnNob3VsZC5ub3QudGhyb3c7XG4gICAgICAgIH0pO1xuICAgICAgICBpdCgnc2hvdWxkIHN1Y2NlZWQgd2l0aCB2YWx1ZSBhYm92ZSAwJywgKCkgPT4ge1xuICAgICAgICAgICgoKSA9PiB7dmFsaWRhdGVTZXJ2ZXJBcmdzKHBhcnNlciwge2JhY2tlbmRSZXRyaWVzOiAxMDB9KTt9KS5zaG91bGQubm90LnRocm93O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19