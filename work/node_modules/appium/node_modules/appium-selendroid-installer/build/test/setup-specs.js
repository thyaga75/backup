'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Promise = require('babel-runtime/core-js/promise')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumSupport = require('appium-support');

var _appiumTestSupport = require('appium-test-support');

var _ = require('..');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('appium-selendroid-installer', function () {
  describe('setupSelendroid', (0, _appiumTestSupport.withMocks)({ fs: _appiumSupport.fs }, function () {}));

  describe('serverExists', (0, _appiumTestSupport.withMocks)({ fs: _appiumSupport.fs }, function (mocks) {
    it('should return true if both apk and manifest exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects("exists").once().withExactArgs(_.SE_APK_PATH).returns(_Promise.resolve(true));
            mocks.fs.expects("exists").once().withExactArgs(_.SE_MANIFEST_PATH).returns(_Promise.resolve(true));
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.serverExists)());

          case 4:
            context$3$0.sent.should.be['true'];

            mocks.fs.verify();

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should return false if apk does not exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects("exists").once().withExactArgs(_.SE_APK_PATH).returns(_Promise.resolve(false));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.serverExists)());

          case 3:
            context$3$0.sent.should.be['false'];

            mocks.fs.verify();

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should return false if manifest does not exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects("exists").once().withExactArgs(_.SE_APK_PATH).returns(_Promise.resolve(true));
            mocks.fs.expects("exists").once().withExactArgs(_.SE_MANIFEST_PATH).returns(_Promise.resolve(false));
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.serverExists)());

          case 4:
            context$3$0.sent.should.be['false'];

            mocks.fs.verify();

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should return false if neither apk or manifest does not exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects("exists").once().withExactArgs(_.SE_APK_PATH).returns(_Promise.resolve(false));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.serverExists)());

          case 3:
            context$3$0.sent.should.be['false'];

            mocks.fs.verify();

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should return false if fs.exists throws a ENOENT error', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects("exists").once().withExactArgs(_.SE_APK_PATH).throws({ code: 'ENOENT' });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.serverExists)());

          case 3:
            context$3$0.sent.should.be['false'];

            mocks.fs.verify();

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should throw an error if fs.exists throws a non-ENOENT error', function callee$2$0() {
      var error;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            error = new Error();

            error.code = 'EACCES';
            mocks.fs.expects("exists").once().withExactArgs(_.SE_APK_PATH).throws(error);
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap((0, _.serverExists)().should.eventually.be.rejectedWith(error));

          case 5:
            mocks.fs.verify();

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
});
//# sourceMappingURL=data:application/json;base64,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QUM5QixhQUFhLGVBQWEsQ0FDMUIsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFDLFFBQVEsRUFBQyxDQUFDLENBQUM7OzZDQUNwQixxQkFBYzs7OzZCQUFFLE1BQU0sQ0FBQyxFQUFFOztBQUNoQyxpQkFBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQzs7Ozs7OztLQUNuQixDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMsOERBQThELEVBQUU7VUFDN0QsS0FBSzs7OztBQUFMLGlCQUFLLEdBQUcsSUFBSSxLQUFLLEVBQUU7O0FBQ3ZCLGlCQUFLLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztBQUN0QixpQkFBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQzlCLGFBQWEsZUFBYSxDQUMxQixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7OzZDQUNYLHFCQUFjLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQzs7O0FBQzdELGlCQUFLLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDOzs7Ozs7O0tBQ25CLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQyxDQUFDO0NBQ0wsQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3Qvc2V0dXAtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgd2l0aE1vY2tzIH0gZnJvbSAnYXBwaXVtLXRlc3Qtc3VwcG9ydCc7XG5pbXBvcnQgeyBzZXJ2ZXJFeGlzdHMsIFNFX0FQS19QQVRILCBTRV9NQU5JRkVTVF9QQVRIIH0gZnJvbSAnLi4nO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmRlc2NyaWJlKCdhcHBpdW0tc2VsZW5kcm9pZC1pbnN0YWxsZXInLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdzZXR1cFNlbGVuZHJvaWQnLCB3aXRoTW9ja3Moe2ZzfSwgKCkgPT4ge1xuICB9KSk7XG5cbiAgZGVzY3JpYmUoJ3NlcnZlckV4aXN0cycsIHdpdGhNb2Nrcyh7ZnN9LCAobW9ja3MpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIGlmIGJvdGggYXBrIGFuZCBtYW5pZmVzdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLmZzLmV4cGVjdHMoXCJleGlzdHNcIikub25jZSgpXG4gICAgICAgIC53aXRoRXhhY3RBcmdzKFNFX0FQS19QQVRIKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUodHJ1ZSkpO1xuICAgICAgbW9ja3MuZnMuZXhwZWN0cyhcImV4aXN0c1wiKS5vbmNlKClcbiAgICAgICAgLndpdGhFeGFjdEFyZ3MoU0VfTUFOSUZFU1RfUEFUSClcbiAgICAgICAgLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHRydWUpKTtcbiAgICAgIChhd2FpdCBzZXJ2ZXJFeGlzdHMoKSkuc2hvdWxkLmJlLnRydWU7XG4gICAgICBtb2Nrcy5mcy52ZXJpZnkoKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBpZiBhcGsgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5mcy5leHBlY3RzKFwiZXhpc3RzXCIpLm9uY2UoKVxuICAgICAgICAud2l0aEV4YWN0QXJncyhTRV9BUEtfUEFUSClcbiAgICAgICAgLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKGZhbHNlKSk7XG4gICAgICAoYXdhaXQgc2VydmVyRXhpc3RzKCkpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIG1vY2tzLmZzLnZlcmlmeSgpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGlmIG1hbmlmZXN0IGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja3MuZnMuZXhwZWN0cyhcImV4aXN0c1wiKS5vbmNlKClcbiAgICAgICAgLndpdGhFeGFjdEFyZ3MoU0VfQVBLX1BBVEgpXG4gICAgICAgIC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh0cnVlKSk7XG4gICAgICBtb2Nrcy5mcy5leHBlY3RzKFwiZXhpc3RzXCIpLm9uY2UoKVxuICAgICAgICAud2l0aEV4YWN0QXJncyhTRV9NQU5JRkVTVF9QQVRIKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoZmFsc2UpKTtcbiAgICAgIChhd2FpdCBzZXJ2ZXJFeGlzdHMoKSkuc2hvdWxkLmJlLmZhbHNlO1xuICAgICAgbW9ja3MuZnMudmVyaWZ5KCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgaWYgbmVpdGhlciBhcGsgb3IgbWFuaWZlc3QgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5mcy5leHBlY3RzKFwiZXhpc3RzXCIpLm9uY2UoKVxuICAgICAgICAud2l0aEV4YWN0QXJncyhTRV9BUEtfUEFUSClcbiAgICAgICAgLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKGZhbHNlKSk7XG4gICAgICAoYXdhaXQgc2VydmVyRXhpc3RzKCkpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIG1vY2tzLmZzLnZlcmlmeSgpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGlmIGZzLmV4aXN0cyB0aHJvd3MgYSBFTk9FTlQgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5mcy5leHBlY3RzKFwiZXhpc3RzXCIpLm9uY2UoKVxuICAgICAgICAud2l0aEV4YWN0QXJncyhTRV9BUEtfUEFUSClcbiAgICAgICAgLnRocm93cyh7Y29kZTonRU5PRU5UJ30pO1xuICAgICAgKGF3YWl0IHNlcnZlckV4aXN0cygpKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBtb2Nrcy5mcy52ZXJpZnkoKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIGZzLmV4aXN0cyB0aHJvd3MgYSBub24tRU5PRU5UIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVycm9yID0gbmV3IEVycm9yKCk7XG4gICAgICBlcnJvci5jb2RlID0gJ0VBQ0NFUyc7XG4gICAgICBtb2Nrcy5mcy5leHBlY3RzKFwiZXhpc3RzXCIpLm9uY2UoKVxuICAgICAgICAud2l0aEV4YWN0QXJncyhTRV9BUEtfUEFUSClcbiAgICAgICAgLnRocm93cyhlcnJvcik7XG4gICAgICBhd2FpdCBzZXJ2ZXJFeGlzdHMoKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoZXJyb3IpO1xuICAgICAgbW9ja3MuZnMudmVyaWZ5KCk7XG4gICAgfSk7XG4gIH0pKTtcbn0pO1xuIl19