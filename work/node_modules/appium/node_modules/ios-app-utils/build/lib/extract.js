'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _appiumSupport = require('appium-support');

var _loggerJs = require('./logger.js');

var _loggerJs2 = _interopRequireDefault(_loggerJs);

var plistObjects = {};

function extractPlist(app) {
  var plistFile;
  return _regeneratorRuntime.async(function extractPlist$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        plistFile = _path2['default'].resolve(app, 'Info.plist');
        context$1$0.prev = 1;
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(_appiumSupport.plist.parsePlistFile(plistFile));

      case 4:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 7:
        context$1$0.prev = 7;
        context$1$0.t0 = context$1$0['catch'](1);

        _loggerJs2['default'].errorAndThrow('Could not extract Info.plist from application: ' + context$1$0.t0.message);

      case 10:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[1, 7]]);
}

function extractPlistEntry(app, entryName) {
  return _regeneratorRuntime.async(function extractPlistEntry$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!_lodash2['default'].isUndefined(plistObjects[app])) {
          context$1$0.next = 4;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(extractPlist(app));

      case 3:
        plistObjects[app] = context$1$0.sent;

      case 4:
        return context$1$0.abrupt('return', plistObjects[app][entryName]);

      case 5:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function clearCache() {
  plistObjects = {};
}

exports['default'] = extractPlistEntry;
exports.extractPlistEntry = extractPlistEntry;
exports.clearCache = clearCache;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9leHRyYWN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7b0JBQWlCLE1BQU07Ozs7c0JBQ1QsUUFBUTs7Ozs2QkFDQSxnQkFBZ0I7O3dCQUN0QixhQUFhOzs7O0FBRzdCLElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQzs7QUFFdEIsU0FBZSxZQUFZLENBQUUsR0FBRztNQUMxQixTQUFTOzs7O0FBQVQsaUJBQVMsR0FBRyxrQkFBSyxPQUFPLENBQUMsR0FBRyxFQUFFLFlBQVksQ0FBQzs7O3lDQUVoQyxxQkFBTSxjQUFjLENBQUMsU0FBUyxDQUFDOzs7Ozs7Ozs7QUFFNUMsOEJBQUksYUFBYSxxREFBbUQsZUFBSSxPQUFPLENBQUcsQ0FBQzs7Ozs7OztDQUV0Rjs7QUFFRCxTQUFlLGlCQUFpQixDQUFFLEdBQUcsRUFBRSxTQUFTOzs7O2FBQzFDLG9CQUFFLFdBQVcsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs7Ozt5Q0FDUixZQUFZLENBQUMsR0FBRyxDQUFDOzs7QUFBM0Msb0JBQVksQ0FBQyxHQUFHLENBQUM7Ozs0Q0FHWixZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDOzs7Ozs7O0NBQ3BDOztBQUVELFNBQVMsVUFBVSxHQUFJO0FBQ3JCLGNBQVksR0FBRyxFQUFFLENBQUM7Q0FDbkI7O3FCQUdjLGlCQUFpQjtRQUN2QixpQkFBaUIsR0FBakIsaUJBQWlCO1FBQUUsVUFBVSxHQUFWLFVBQVUiLCJmaWxlIjoibGliL2V4dHJhY3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBwbGlzdCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXIuanMnO1xuXG5cbmxldCBwbGlzdE9iamVjdHMgPSB7fTtcblxuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdFBsaXN0IChhcHApIHtcbiAgbGV0IHBsaXN0RmlsZSA9IHBhdGgucmVzb2x2ZShhcHAsICdJbmZvLnBsaXN0Jyk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHBsaXN0LnBhcnNlUGxpc3RGaWxlKHBsaXN0RmlsZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZXh0cmFjdCBJbmZvLnBsaXN0IGZyb20gYXBwbGljYXRpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdFBsaXN0RW50cnkgKGFwcCwgZW50cnlOYW1lKSB7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBsaXN0T2JqZWN0c1thcHBdKSkge1xuICAgIHBsaXN0T2JqZWN0c1thcHBdID0gYXdhaXQgZXh0cmFjdFBsaXN0KGFwcCk7XG4gIH1cblxuICByZXR1cm4gcGxpc3RPYmplY3RzW2FwcF1bZW50cnlOYW1lXTtcbn1cblxuZnVuY3Rpb24gY2xlYXJDYWNoZSAoKSB7XG4gIHBsaXN0T2JqZWN0cyA9IHt9O1xufVxuXG5cbmV4cG9ydCBkZWZhdWx0IGV4dHJhY3RQbGlzdEVudHJ5O1xuZXhwb3J0IHsgZXh0cmFjdFBsaXN0RW50cnksIGNsZWFyQ2FjaGUgfTtcbiJdfQ==