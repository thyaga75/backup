require('source-map-support').install();

'use strict';

var _Promise = require('babel-runtime/core-js/promise')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _teen_process = require('teen_process');

var TeenProcess = _interopRequireWildcard(_teen_process);

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

var _nodeSimctl = require('node-simctl');

var nodeSimctl = _interopRequireWildcard(_nodeSimctl);

var _ = require('../..');

var _assetsDeviceList = require('../assets/deviceList');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var XCODE_VERSION_7 = {
  versionString: '7.1.1',
  versionFloat: 7.1,
  major: 7,
  minor: 1,
  patch: 1
};
var XCODE_VERSION_6 = {
  versionString: '6.1.1',
  versionFloat: 6.1,
  major: 6,
  minor: 1,
  patch: 1
};

describe('util', function () {
  var execStub = undefined;
  var xcodeMock = undefined;
  var getDevicesStub = undefined;

  beforeEach(function () {
    execStub = _sinon2['default'].stub(TeenProcess, 'exec');
    xcodeMock = _sinon2['default'].mock(_appiumXcode2['default']);
    getDevicesStub = _sinon2['default'].stub(nodeSimctl, 'getDevices');
    getDevicesStub.returns(_Promise.resolve(_assetsDeviceList.devices));
  });
  afterEach(function () {
    execStub.restore();
    xcodeMock.restore();
    nodeSimctl.getDevices.restore();
  });

  describe('killAllSimulators', function () {
    it('should call exec with Simulator for Xcode 7', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeMock.expects('getVersion').withArgs(true).returns(_Promise.resolve(XCODE_VERSION_7));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 3:
            execStub.calledOnce.should.be['true'];

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should call exec with iOS Simulator for Xcode 6', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeMock.expects('getVersion').withArgs(true).returns(_Promise.resolve(XCODE_VERSION_6));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 3:
            execStub.calledOnce.should.be['true'];

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should continue if application is not running error gets thrown', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeMock.expects('getVersion').withArgs(true).returns(_Promise.resolve(XCODE_VERSION_7));
            execStub.throws('{"stdout":"","stderr":"0:24: execution error: iOS Simulator got an error: Application isnâ€™t running. (-600)\n","code":1}');
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('endAllSimulatorDaemons', function () {
    it('should call exec five times to stop and remove each service', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.endAllSimulatorDaemons)());

          case 2:
            execStub.callCount.should.equal(5);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should ignore all errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            execStub.throws();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.endAllSimulatorDaemons)().should.not.be.rejected);

          case 3:
            execStub.callCount.should.equal(5);
            execStub.threw().should.be['true'];

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('simExists', function () {

    it('returns true if device is found', function callee$2$0() {
      var existence, results, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, result;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            existence = [(0, _.simExists)('C09B34E5-7DCB-442E-B79C-AB6BC0357417'), (0, _.simExists)('FA5C971D-4E05-4AA3-B48B-C9619C7453BE'), (0, _.simExists)('E46EFA59-E2B4-4FF9-B290-B61F3CFECC65'), (0, _.simExists)('F33783B2-9EE9-4A99-866E-E126ADBAD410')];
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(existence));

          case 3:
            results = context$3$0.sent;
            _iteratorNormalCompletion = true;
            _didIteratorError = false;
            _iteratorError = undefined;
            context$3$0.prev = 7;

            for (_iterator = _getIterator(results); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              result = _step.value;

              result.should.be['true'];
            }
            context$3$0.next = 15;
            break;

          case 11:
            context$3$0.prev = 11;
            context$3$0.t0 = context$3$0['catch'](7);
            _didIteratorError = true;
            _iteratorError = context$3$0.t0;

          case 15:
            context$3$0.prev = 15;
            context$3$0.prev = 16;

            if (!_iteratorNormalCompletion && _iterator['return']) {
              _iterator['return']();
            }

          case 18:
            context$3$0.prev = 18;

            if (!_didIteratorError) {
              context$3$0.next = 21;
              break;
            }

            throw _iteratorError;

          case 21:
            return context$3$0.finish(18);

          case 22:
            return context$3$0.finish(15);

          case 23:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this, [[7, 11, 15, 23], [16,, 18, 22]]);
    });

    it('returns false if device is not found', function callee$2$0() {
      var existence, results, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, result;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            existence = [];

            existence.push((0, _.simExists)('A94E4CD7-D412-4198-BCD4-26799672975E'));
            existence.push((0, _.simExists)('asdf'));
            existence.push((0, _.simExists)(4));

            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(existence));

          case 6:
            results = context$3$0.sent;
            _iteratorNormalCompletion2 = true;
            _didIteratorError2 = false;
            _iteratorError2 = undefined;
            context$3$0.prev = 10;

            for (_iterator2 = _getIterator(results); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              result = _step2.value;

              result.should.be['false'];
            }
            context$3$0.next = 18;
            break;

          case 14:
            context$3$0.prev = 14;
            context$3$0.t0 = context$3$0['catch'](10);
            _didIteratorError2 = true;
            _iteratorError2 = context$3$0.t0;

          case 18:
            context$3$0.prev = 18;
            context$3$0.prev = 19;

            if (!_iteratorNormalCompletion2 && _iterator2['return']) {
              _iterator2['return']();
            }

          case 21:
            context$3$0.prev = 21;

            if (!_didIteratorError2) {
              context$3$0.next = 24;
              break;
            }

            throw _iteratorError2;

          case 24:
            return context$3$0.finish(21);

          case 25:
            return context$3$0.finish(18);

          case 26:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this, [[10, 14, 18, 26], [19,, 21, 25]]);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC91dGlscy1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O29CQUVpQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7OztxQkFDM0IsT0FBTzs7Ozt3QkFDWCxVQUFVOzs7OzRCQUNLLGNBQWM7O0lBQS9CLFdBQVc7OzJCQUNMLGNBQWM7Ozs7MEJBQ0osYUFBYTs7SUFBN0IsVUFBVTs7Z0JBQytDLE9BQU87O2dDQUNwRCxzQkFBc0I7O0FBRzlDLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxlQUFlLEdBQUc7QUFDdEIsZUFBYSxFQUFFLE9BQU87QUFDdEIsY0FBWSxFQUFFLEdBQUc7QUFDakIsT0FBSyxFQUFFLENBQUM7QUFDUixPQUFLLEVBQUUsQ0FBQztBQUNSLE9BQUssRUFBRSxDQUFDO0NBQ1QsQ0FBQztBQUNGLElBQU0sZUFBZSxHQUFHO0FBQ3RCLGVBQWEsRUFBRSxPQUFPO0FBQ3RCLGNBQVksRUFBRSxHQUFHO0FBQ2pCLE9BQUssRUFBRSxDQUFDO0FBQ1IsT0FBSyxFQUFFLENBQUM7QUFDUixPQUFLLEVBQUUsQ0FBQztDQUNULENBQUM7O0FBRUYsUUFBUSxDQUFDLE1BQU0sRUFBRSxZQUFNO0FBQ3JCLE1BQUksUUFBUSxZQUFBLENBQUM7QUFDYixNQUFJLFNBQVMsWUFBQSxDQUFDO0FBQ2QsTUFBSSxjQUFjLFlBQUEsQ0FBQzs7QUFFbkIsWUFBVSxDQUFDLFlBQU07QUFDZixZQUFRLEdBQUcsbUJBQU0sSUFBSSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUMzQyxhQUFTLEdBQUcsbUJBQU0sSUFBSSwwQkFBTyxDQUFDO0FBQzlCLGtCQUFjLEdBQUcsbUJBQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUN0RCxrQkFBYyxDQUFDLE9BQU8sQ0FBQyxTQUFRLE9BQU8sMkJBQVMsQ0FBQyxDQUFDO0dB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cUJBQVMsR0FBRyxFQUFFOztBQUNqQixxQkFBUyxDQUFDLElBQUksQ0FBQyxpQkFBVSxzQ0FBc0MsQ0FBQyxDQUFDLENBQUM7QUFDbEUscUJBQVMsQ0FBQyxJQUFJLENBQUMsaUJBQVUsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUNsQyxxQkFBUyxDQUFDLElBQUksQ0FBQyxpQkFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7NkNBRVQsc0JBQUUsR0FBRyxDQUFDLFNBQVMsQ0FBQzs7O0FBQWhDLG1CQUFPOzs7Ozs7QUFFWCwyQ0FBbUIsT0FBTyx5R0FBRTtBQUFuQixvQkFBTTs7QUFDYixvQkFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQzthQUN4Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBQ0gsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvdW5pdC91dGlscy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgKiBhcyBUZWVuUHJvY2VzcyBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHhjb2RlIGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgKiBhcyBub2RlU2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcbmltcG9ydCB7IGtpbGxBbGxTaW11bGF0b3JzLCBlbmRBbGxTaW11bGF0b3JEYWVtb25zLCBzaW1FeGlzdHMgfSBmcm9tICcuLi8uLic7XG5pbXBvcnQgeyBkZXZpY2VzIH0gZnJvbSAnLi4vYXNzZXRzL2RldmljZUxpc3QnO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmNvbnN0IFhDT0RFX1ZFUlNJT05fNyA9IHtcbiAgdmVyc2lvblN0cmluZzogJzcuMS4xJyxcbiAgdmVyc2lvbkZsb2F0OiA3LjEsXG4gIG1ham9yOiA3LFxuICBtaW5vcjogMSxcbiAgcGF0Y2g6IDFcbn07XG5jb25zdCBYQ09ERV9WRVJTSU9OXzYgPSB7XG4gIHZlcnNpb25TdHJpbmc6ICc2LjEuMScsXG4gIHZlcnNpb25GbG9hdDogNi4xLFxuICBtYWpvcjogNixcbiAgbWlub3I6IDEsXG4gIHBhdGNoOiAxXG59O1xuXG5kZXNjcmliZSgndXRpbCcsICgpID0+IHtcbiAgbGV0IGV4ZWNTdHViO1xuICBsZXQgeGNvZGVNb2NrO1xuICBsZXQgZ2V0RGV2aWNlc1N0dWI7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgZXhlY1N0dWIgPSBzaW5vbi5zdHViKFRlZW5Qcm9jZXNzLCAnZXhlYycpO1xuICAgIHhjb2RlTW9jayA9IHNpbm9uLm1vY2soeGNvZGUpO1xuICAgIGdldERldmljZXNTdHViID0gc2lub24uc3R1Yihub2RlU2ltY3RsLCAnZ2V0RGV2aWNlcycpO1xuICAgIGdldERldmljZXNTdHViLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKGRldmljZXMpKTtcbiAgfSk7XG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgZXhlY1N0dWIucmVzdG9yZSgpO1xuICAgIHhjb2RlTW9jay5yZXN0b3JlKCk7XG4gICAgbm9kZVNpbWN0bC5nZXREZXZpY2VzLnJlc3RvcmUoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2tpbGxBbGxTaW11bGF0b3JzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsbCBleGVjIHdpdGggU2ltdWxhdG9yIGZvciBYY29kZSA3JywgYXN5bmMgKCkgPT4ge1xuICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldFZlcnNpb24nKS53aXRoQXJncyh0cnVlKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShYQ09ERV9WRVJTSU9OXzcpKTtcbiAgICAgIGF3YWl0IGtpbGxBbGxTaW11bGF0b3JzKCk7XG4gICAgICBleGVjU3R1Yi5jYWxsZWRPbmNlLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY2FsbCBleGVjIHdpdGggaU9TIFNpbXVsYXRvciBmb3IgWGNvZGUgNicsIGFzeW5jICgpID0+IHtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykud2l0aEFyZ3ModHJ1ZSkucmV0dXJucyhQcm9taXNlLnJlc29sdmUoWENPREVfVkVSU0lPTl82KSk7XG4gICAgICBhd2FpdCBraWxsQWxsU2ltdWxhdG9ycygpO1xuICAgICAgZXhlY1N0dWIuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNvbnRpbnVlIGlmIGFwcGxpY2F0aW9uIGlzIG5vdCBydW5uaW5nIGVycm9yIGdldHMgdGhyb3duJywgYXN5bmMgKCkgPT4ge1xuICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldFZlcnNpb24nKS53aXRoQXJncyh0cnVlKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShYQ09ERV9WRVJTSU9OXzcpKTtcbiAgICAgIGV4ZWNTdHViLnRocm93cygne1wic3Rkb3V0XCI6XCJcIixcInN0ZGVyclwiOlwiMDoyNDogZXhlY3V0aW9uIGVycm9yOiBpT1MgU2ltdWxhdG9yIGdvdCBhbiBlcnJvcjogQXBwbGljYXRpb24gaXNu4oCZdCBydW5uaW5nLiAoLTYwMClcXG5cIixcImNvZGVcIjoxfScpO1xuICAgICAgYXdhaXQga2lsbEFsbFNpbXVsYXRvcnMoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2VuZEFsbFNpbXVsYXRvckRhZW1vbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxsIGV4ZWMgZml2ZSB0aW1lcyB0byBzdG9wIGFuZCByZW1vdmUgZWFjaCBzZXJ2aWNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZW5kQWxsU2ltdWxhdG9yRGFlbW9ucygpO1xuICAgICAgZXhlY1N0dWIuY2FsbENvdW50LnNob3VsZC5lcXVhbCg1KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGlnbm9yZSBhbGwgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZXhlY1N0dWIudGhyb3dzKCk7XG4gICAgICBhd2FpdCBlbmRBbGxTaW11bGF0b3JEYWVtb25zKCkuc2hvdWxkLm5vdC5iZS5yZWplY3RlZDtcbiAgICAgIGV4ZWNTdHViLmNhbGxDb3VudC5zaG91bGQuZXF1YWwoNSk7XG4gICAgICBleGVjU3R1Yi50aHJldygpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2ltRXhpc3RzJywgKCkgPT4ge1xuXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiBkZXZpY2UgaXMgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZXhpc3RlbmNlID0gW1xuICAgICAgIHNpbUV4aXN0cygnQzA5QjM0RTUtN0RDQi00NDJFLUI3OUMtQUI2QkMwMzU3NDE3JyksXG4gICAgICAgc2ltRXhpc3RzKCdGQTVDOTcxRC00RTA1LTRBQTMtQjQ4Qi1DOTYxOUM3NDUzQkUnKSxcbiAgICAgICBzaW1FeGlzdHMoJ0U0NkVGQTU5LUUyQjQtNEZGOS1CMjkwLUI2MUYzQ0ZFQ0M2NScpLFxuICAgICAgIHNpbUV4aXN0cygnRjMzNzgzQjItOUVFOS00QTk5LTg2NkUtRTEyNkFEQkFENDEwJylcbiAgICAgXTtcblxuICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgQi5hbGwoZXhpc3RlbmNlKTtcblxuICAgICAgIGZvciAobGV0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgICAgICByZXN1bHQuc2hvdWxkLmJlLnRydWU7XG4gICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgZmFsc2UgaWYgZGV2aWNlIGlzIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdGVuY2UgPSBbXTtcbiAgICAgICBleGlzdGVuY2UucHVzaChzaW1FeGlzdHMoJ0E5NEU0Q0Q3LUQ0MTItNDE5OC1CQ0Q0LTI2Nzk5NjcyOTc1RScpKTtcbiAgICAgICBleGlzdGVuY2UucHVzaChzaW1FeGlzdHMoJ2FzZGYnKSk7XG4gICAgICAgZXhpc3RlbmNlLnB1c2goc2ltRXhpc3RzKDQpKTtcblxuICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgQi5hbGwoZXhpc3RlbmNlKTtcblxuICAgICAgIGZvciAobGV0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgICAgICByZXN1bHQuc2hvdWxkLmJlLmZhbHNlO1xuICAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==