'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersEnv = require('../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

describe('safari - page load timeout', function () {
  if (!_helpersEnv2['default'].IOS81) {
    return;
  }

  describe('small timeout, slow page load', function () {
    var _this = this;

    var driver = (0, _setupBase2['default'])(this, { browserName: 'safari' }).driver;

    it('should go to the requested page', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.timeouts('page load', 5000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.setUrl(_helpersEnv2['default'].GUINEA_TEST_END_POINT + '?delay=30000'));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.getPageSource());

          case 6:
            context$3$0.sent.should.include('Let\'s browse!');

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('no timeout, very slow page', function () {
    var _this2 = this;

    var startMs = Date.now();
    var driver = (0, _setupBase2['default'])(this, { browserName: 'safari' }).driver;

    it('should go to the requested page', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.timeouts('command', 120000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.timeouts('page load', -1));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.setUrl(_helpersEnv2['default'].GUINEA_TEST_END_POINT + '?delay=70000'));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(driver.getPageSource());

          case 8:
            context$3$0.sent.should.include('I am some page content');

            (Date.now() - startMs).should.be.above(70000);

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});

// the page should not have time to load

// the page should load after 70000
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS9wYWdlLWxvYWQtdGltZW91dC1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7eUJBQWtCLGVBQWU7Ozs7MEJBQ2pCLGdCQUFnQjs7OztBQUVoQyxRQUFRLENBQUMsNEJBQTRCLEVBQUUsWUFBVztBQUNoRCxNQUFJLENBQUMsd0JBQUksS0FBSyxFQUFFO0FBQ2QsV0FBTztHQUNSOztBQUVELFVBQVEsQ0FBQywrQkFBK0IsRUFBRSxZQUFXOzs7QUFDbkQsUUFBTSxNQUFNLEdBQUcsNEJBQU0sSUFBSSxFQUFFLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDOztBQUU3RCxNQUFFLENBQUMsaUNBQWlDLEVBQUU7Ozs7OzZDQUM5QixNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUM7Ozs7NkNBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsd0JBQUkscUJBQXFCLEdBQUcsY0FBYyxDQUFDOzs7OzZDQUd4RCxNQUFNLENBQUMsYUFBYSxFQUFFOzs7NkJBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0I7Ozs7Ozs7S0FDL0QsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyw0QkFBNEIsRUFBRSxZQUFXOzs7QUFDaEQsUUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3pCLFFBQU0sTUFBTSxHQUFHLDRCQUFNLElBQUksRUFBRSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQzs7QUFFN0QsTUFBRSxDQUFDLGlDQUFpQyxFQUFFOzs7Ozs2Q0FDOUIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDOzs7OzZDQUNsQyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQzs7Ozs2Q0FDaEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyx3QkFBSSxxQkFBcUIsR0FBRyxjQUFjLENBQUM7Ozs7NkNBR3hELE1BQU0sQ0FBQyxhQUFhLEVBQUU7Ozs2QkFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLHdCQUF3Qjs7QUFDdEUsYUFBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsT0FBTyxDQUFBLENBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7Ozs7Ozs7S0FDL0MsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZTJlL3NhZmFyaS9wYWdlLWxvYWQtdGltZW91dC1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzZXR1cCBmcm9tIFwiLi4vc2V0dXAtYmFzZVwiO1xuaW1wb3J0IGVudiBmcm9tICcuLi9oZWxwZXJzL2Vudic7XG5cbmRlc2NyaWJlKCdzYWZhcmkgLSBwYWdlIGxvYWQgdGltZW91dCcsIGZ1bmN0aW9uKCkge1xuICBpZiAoIWVudi5JT1M4MSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGRlc2NyaWJlKCdzbWFsbCB0aW1lb3V0LCBzbG93IHBhZ2UgbG9hZCcsIGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIHsgYnJvd3Nlck5hbWU6ICdzYWZhcmknIH0pLmRyaXZlcjtcblxuICAgIGl0KCdzaG91bGQgZ28gdG8gdGhlIHJlcXVlc3RlZCBwYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLnRpbWVvdXRzKCdwYWdlIGxvYWQnLCA1MDAwKTtcbiAgICAgIGF3YWl0IGRyaXZlci5zZXRVcmwoZW52LkdVSU5FQV9URVNUX0VORF9QT0lOVCArICc/ZGVsYXk9MzAwMDAnKTtcblxuICAgICAgLy8gdGhlIHBhZ2Ugc2hvdWxkIG5vdCBoYXZlIHRpbWUgdG8gbG9hZFxuICAgICAgKGF3YWl0IGRyaXZlci5nZXRQYWdlU291cmNlKCkpLnNob3VsZC5pbmNsdWRlKCdMZXRcXCdzIGJyb3dzZSEnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ25vIHRpbWVvdXQsIHZlcnkgc2xvdyBwYWdlJywgZnVuY3Rpb24oKSB7XG4gICAgbGV0IHN0YXJ0TXMgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIHsgYnJvd3Nlck5hbWU6ICdzYWZhcmknIH0pLmRyaXZlcjtcblxuICAgIGl0KCdzaG91bGQgZ28gdG8gdGhlIHJlcXVlc3RlZCBwYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLnRpbWVvdXRzKCdjb21tYW5kJywgMTIwMDAwKTtcbiAgICAgIGF3YWl0IGRyaXZlci50aW1lb3V0cygncGFnZSBsb2FkJywgLTEpO1xuICAgICAgYXdhaXQgZHJpdmVyLnNldFVybChlbnYuR1VJTkVBX1RFU1RfRU5EX1BPSU5UICsgJz9kZWxheT03MDAwMCcpO1xuXG4gICAgICAvLyB0aGUgcGFnZSBzaG91bGQgbG9hZCBhZnRlciA3MDAwMFxuICAgICAgKGF3YWl0IGRyaXZlci5nZXRQYWdlU291cmNlKCkpLnNob3VsZC5pbmNsdWRlKCdJIGFtIHNvbWUgcGFnZSBjb250ZW50Jyk7XG4gICAgICAoRGF0ZS5ub3coKSAtIHN0YXJ0TXMpLnNob3VsZC5iZS5hYm92ZSg3MDAwMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=