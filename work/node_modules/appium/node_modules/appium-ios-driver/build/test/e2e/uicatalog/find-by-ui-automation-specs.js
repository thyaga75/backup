'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _helpersEnv = require('../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _helpersRecipes = require('../helpers/recipes');

//  , filterVisible = require('../../../helpers/ios-uiautomation').filterVisible;

describe('uicatalog - find by ios-ui-automation', function () {
  var _this = this;

  var session = (0, _setupBase2['default'])(this, _desired2['default']);
  var driver = session.driver;

  var byUIA = '-ios uiautomation';

  before(function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.navigationBars()[0]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

        case 5:
          context$2$0.t0 = context$2$0.sent;

          if (!(context$2$0.t0 !== 'UICatalog')) {
            context$2$0.next = 9;
            break;
          }

          context$2$0.next = 9;
          return _regeneratorRuntime.awrap((0, _helpersRecipes.clickButton)(driver, 'UICatalog'));

        case 9:
          context$2$0.next = 11;
          return _regeneratorRuntime.awrap(_bluebird2['default'].delay(500));

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should process most basic UIAutomation query', function callee$1$0() {
    var els, displayedEls;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements(byUIA, '.elements()'));

        case 2:
          els = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _helpersRecipes.filterDisplayed)(driver, els));

        case 5:
          displayedEls = context$2$0.sent;

          displayedEls.should.have.length(2);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should use raw selector code if selector does not start with a dot', function callee$1$0() {
    var els, displayedEls;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements(byUIA, '$.mainWindow().elements()'));

        case 2:
          els = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _helpersRecipes.filterDisplayed)(driver, els));

        case 5:
          displayedEls = context$2$0.sent;

          displayedEls.should.have.length(2);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get a single element', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.elements()[0]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

        case 5:
          context$2$0.sent.should.equal('UICatalog');

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get a single element with non-zero index', function callee$1$0() {
    var name, el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          name = _helpersEnv2['default'].IOS8 || _helpersEnv2['default'].IOS9 ? '' : 'Empty list';
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.elements()[1]'));

        case 3:
          el = context$2$0.sent;
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

        case 6:
          context$2$0.t0 = name;
          context$2$0.sent.should.equal(context$2$0.t0);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get single element as array', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements(byUIA, '.tableViews()[0]'));

        case 2:
          els = context$2$0.sent;

          els.should.have.length(1);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should find elements by index multiple times', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.elements()[1].cells()[2]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

        case 5:
          context$2$0.sent.should.include('Alert Views');

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should find element by name', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.elements()["UICatalog"]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

        case 5:
          context$2$0.sent.should.equal('UICatalog');

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should find element by type and index', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.navigationBar().elements()[1]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

        case 5:
          context$2$0.sent.should.equal('Back');

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('start from a given context instead of root target', function () {
    var _this2 = this;

    it('should process a simple query', function callee$2$0() {
      var el, els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.elements()[1]'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.findElementsFromElement(byUIA, (0, _helpersRecipes.filterVisibleUiaSelector)('.elements();'), el));

          case 5:
            els = context$3$0.sent;

            els.should.have.length.at.least(10);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should find element by name', function callee$2$0() {
      var axIdExt, el1, el2;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            axIdExt = _helpersEnv2['default'].IOS8 || _helpersEnv2['default'].IOS9 ? "" : ", AAPLButtonViewController";
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.findElement(byUIA, '.elements()[1]'));

          case 3:
            el1 = context$3$0.sent;
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.findElementFromElement(byUIA, '.elements()["Buttons' + axIdExt + '"]', el1));

          case 6:
            el2 = context$3$0.sent;

            el2.should.exist;

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3VpY2F0YWxvZy9maW5kLWJ5LXVpLWF1dG9tYXRpb24tc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OzBCQUFnQixnQkFBZ0I7Ozs7eUJBQ2QsZUFBZTs7Ozt1QkFDYixXQUFXOzs7O3dCQUNqQixVQUFVOzs7OzhCQUMrQyxvQkFBb0I7Ozs7QUFHM0YsUUFBUSxDQUFDLHVDQUF1QyxFQUFFLFlBQVk7OztBQUM1RCxNQUFJLE9BQU8sR0FBRyw0QkFBTSxJQUFJLHVCQUFVLENBQUM7QUFDbkMsTUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUIsTUFBSSxLQUFLLEdBQUcsbUJBQW1CLENBQUM7O0FBRWhDLFFBQU0sQ0FBQztRQUNELEVBQUU7Ozs7OzJDQUFTLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLHNCQUFzQixDQUFDOzs7QUFBNUQsWUFBRTs7MkNBQ0ssTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDOzs7OzttQ0FBTSxXQUFXOzs7Ozs7MkNBQ25ELGlDQUFZLE1BQU0sRUFBRSxXQUFXLENBQUM7Ozs7MkNBRWxDLHNCQUFFLEtBQUssQ0FBQyxHQUFHLENBQUM7Ozs7Ozs7R0FDbkIsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyw4Q0FBOEMsRUFBRTtRQUM3QyxHQUFHLEVBQ0gsWUFBWTs7Ozs7MkNBREEsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDOzs7QUFBckQsYUFBRzs7MkNBQ2tCLHFDQUFnQixNQUFNLEVBQUUsR0FBRyxDQUFDOzs7QUFBakQsc0JBQVk7O0FBQ2hCLHNCQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7R0FDcEMsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyxvRUFBb0UsRUFBRTtRQUNuRSxHQUFHLEVBQ0gsWUFBWTs7Ozs7MkNBREEsTUFBTSxDQUFD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QUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsNkJBQTZCLEVBQUU7VUFDNUIsT0FBTyxFQUNQLEdBQUcsRUFDSCxHQUFHOzs7O0FBRkgsbUJBQU8sR0FBRyx3QkFBSSxJQUFJLElBQUksd0JBQUksSUFBSSxHQUFHLEVBQUUsR0FBRyw0QkFBNEI7OzZDQUN0RCxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQzs7O0FBQXZELGVBQUc7OzZDQUNTLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLDJCQUF5QixPQUFPLFNBQU0sR0FBRyxDQUFDOzs7QUFBekYsZUFBRzs7QUFDUCxlQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzs7Ozs7OztLQUNsQixDQUFDLENBQUM7R0FFSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvdWljYXRhbG9nL2ZpbmQtYnktdWktYXV0b21hdGlvbi1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBlbnYgZnJvbSAnLi4vaGVscGVycy9lbnYnO1xuaW1wb3J0IHNldHVwIGZyb20gXCIuLi9zZXR1cC1iYXNlXCI7XG5pbXBvcnQgZGVzaXJlZCBmcm9tICcuL2Rlc2lyZWQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgY2xpY2tCdXR0b24sIGZpbHRlckRpc3BsYXllZCwgZmlsdGVyVmlzaWJsZVVpYVNlbGVjdG9yIH0gZnJvbSAnLi4vaGVscGVycy9yZWNpcGVzJztcbi8vICAsIGZpbHRlclZpc2libGUgPSByZXF1aXJlKCcuLi8uLi8uLi9oZWxwZXJzL2lvcy11aWF1dG9tYXRpb24nKS5maWx0ZXJWaXNpYmxlO1xuXG5kZXNjcmliZSgndWljYXRhbG9nIC0gZmluZCBieSBpb3MtdWktYXV0b21hdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHNlc3Npb24gPSBzZXR1cCh0aGlzLCBkZXNpcmVkKTtcbiAgbGV0IGRyaXZlciA9IHNlc3Npb24uZHJpdmVyO1xuXG4gIGxldCBieVVJQSA9ICctaW9zIHVpYXV0b21hdGlvbic7XG5cbiAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoYnlVSUEsICcubmF2aWdhdGlvbkJhcnMoKVswXScpO1xuICAgIGlmICgoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgnbmFtZScsIGVsKSkgIT09ICdVSUNhdGFsb2cnKSB7XG4gICAgICBhd2FpdCBjbGlja0J1dHRvbihkcml2ZXIsICdVSUNhdGFsb2cnKTtcbiAgICB9XG4gICAgYXdhaXQgQi5kZWxheSg1MDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHByb2Nlc3MgbW9zdCBiYXNpYyBVSUF1dG9tYXRpb24gcXVlcnknLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoYnlVSUEsICcuZWxlbWVudHMoKScpO1xuICAgIGxldCBkaXNwbGF5ZWRFbHMgPSBhd2FpdCBmaWx0ZXJEaXNwbGF5ZWQoZHJpdmVyLCBlbHMpO1xuICAgIGRpc3BsYXllZEVscy5zaG91bGQuaGF2ZS5sZW5ndGgoMik7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdXNlIHJhdyBzZWxlY3RvciBjb2RlIGlmIHNlbGVjdG9yIGRvZXMgbm90IHN0YXJ0IHdpdGggYSBkb3QnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoYnlVSUEsICckLm1haW5XaW5kb3coKS5lbGVtZW50cygpJyk7XG4gICAgbGV0IGRpc3BsYXllZEVscyA9IGF3YWl0IGZpbHRlckRpc3BsYXllZChkcml2ZXIsIGVscyk7XG4gICAgZGlzcGxheWVkRWxzLnNob3VsZC5oYXZlLmxlbmd0aCgyKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgYSBzaW5nbGUgZWxlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoYnlVSUEsICcuZWxlbWVudHMoKVswXScpO1xuICAgIChhd2FpdCBkcml2ZXIuZ2V0QXR0cmlidXRlKCduYW1lJywgZWwpKS5zaG91bGQuZXF1YWwoJ1VJQ2F0YWxvZycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBhIHNpbmdsZSBlbGVtZW50IHdpdGggbm9uLXplcm8gaW5kZXgnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IG5hbWUgPSBlbnYuSU9TOCB8fCBlbnYuSU9TOSA/ICcnIDogJ0VtcHR5IGxpc3QnO1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudChieVVJQSwgJy5lbGVtZW50cygpWzFdJyk7XG4gICAgKGF3YWl0IGRyaXZlci5nZXRBdHRyaWJ1dGUoJ25hbWUnLCBlbCkpLnNob3VsZC5lcXVhbChuYW1lKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgc2luZ2xlIGVsZW1lbnQgYXMgYXJyYXknLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoYnlVSUEsICcudGFibGVWaWV3cygpWzBdJyk7XG4gICAgZWxzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnRzIGJ5IGluZGV4IG11bHRpcGxlIHRpbWVzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudChieVVJQSwgJy5lbGVtZW50cygpWzFdLmNlbGxzKClbMl0nKTtcbiAgICAoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgnbmFtZScsIGVsKSkuc2hvdWxkLmluY2x1ZGUoJ0FsZXJ0IFZpZXdzJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCBlbGVtZW50IGJ5IG5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KGJ5VUlBLCAnLmVsZW1lbnRzKClbXCJVSUNhdGFsb2dcIl0nKTtcbiAgICAoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgnbmFtZScsIGVsKSkuc2hvdWxkLmVxdWFsKCdVSUNhdGFsb2cnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgdHlwZSBhbmQgaW5kZXgnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KGJ5VUlBLCAnLm5hdmlnYXRpb25CYXIoKS5lbGVtZW50cygpWzFdJyk7XG4gICAgKGF3YWl0IGRyaXZlci5nZXRBdHRyaWJ1dGUoJ25hbWUnLCBlbCkpLnNob3VsZC5lcXVhbCgnQmFjaycpO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RhcnQgZnJvbSBhIGdpdmVuIGNvbnRleHQgaW5zdGVhZCBvZiByb290IHRhcmdldCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgYSBzaW1wbGUgcXVlcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoYnlVSUEsICcuZWxlbWVudHMoKVsxXScpO1xuICAgICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHNGcm9tRWxlbWVudChieVVJQSwgZmlsdGVyVmlzaWJsZVVpYVNlbGVjdG9yKCcuZWxlbWVudHMoKTsnKSwgZWwpO1xuICAgICAgZWxzLnNob3VsZC5oYXZlLmxlbmd0aC5hdC5sZWFzdCgxMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSBuYW1lJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGF4SWRFeHQgPSBlbnYuSU9TOCB8fCBlbnYuSU9TOSA/IFwiXCIgOiBcIiwgQUFQTEJ1dHRvblZpZXdDb250cm9sbGVyXCI7XG4gICAgICBsZXQgZWwxID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KGJ5VUlBLCAnLmVsZW1lbnRzKClbMV0nKTtcbiAgICAgIGxldCBlbDIgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRGcm9tRWxlbWVudChieVVJQSwgYC5lbGVtZW50cygpW1wiQnV0dG9ucyR7YXhJZEV4dH1cIl1gLCBlbDEpO1xuICAgICAgZWwyLnNob3VsZC5leGlzdDtcbiAgICB9KTtcblxuICB9KTtcbn0pO1xuIl19