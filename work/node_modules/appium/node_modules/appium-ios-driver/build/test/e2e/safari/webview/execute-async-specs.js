/* globals expect */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _setupBase = require('../../setup-base');

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersWebview = require('../../helpers/webview');

describe('safari - webview - executeAsync', function () {
  var _this = this;

  var driver = (0, _setupBase2['default'])(this, _desired2['default'], { 'no-reset': true }, false, true).driver;
  beforeEach(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

        case 2:
          return context$2$0.abrupt('return', context$2$0.sent);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should bubble up javascript errors', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      var _this2 = this;

      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          expect(function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(driver.executeAsync('\'nan\'--'));

                case 2:
                  return context$3$0.abrupt('return', context$3$0.sent);

                case 3:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this2);
          }).to['throw'];

        case 1:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should execute async javascript', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(10000));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.executeAsync('arguments[arguments.length - 1](123);'));

        case 4:
          context$2$0.sent.should.be.equal(123);

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should timeout when callback is not invoked', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      var _this3 = this;

      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(4000));

        case 2:
          expect(function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(driver.executeAsync('return 1 + 2'));

                case 2:
                  return context$3$0.abrupt('return', context$3$0.sent);

                case 3:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this3);
          }).to['throw'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2V4ZWN1dGUtYXN5bmMtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozt1QkFDb0IsV0FBVzs7Ozt5QkFDYixrQkFBa0I7Ozs7OEJBQ1IsdUJBQXVCOztBQUVuRCxRQUFRLENBQUMsaUNBQWlDLEVBQUUsWUFBVzs7O0FBQ3JELE1BQU0sTUFBTSxHQUFHLDRCQUFNLElBQUksd0JBQVcsRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUM1RSxZQUFVLENBQUM7Ozs7OzJDQUFrQix1REFBcUIsTUFBTSxDQUFDOzs7Ozs7Ozs7O0dBQUEsQ0FBQyxDQUFDOztBQUUzRCxJQUFFLENBQUMsb0NBQW9DLEVBQUU7Ozs7OztBQUN2QyxnQkFBTSxDQUFDOzs7OzttREFBa0IsTUFBTSxDQUFDLFlBQVksYUFBVzs7Ozs7Ozs7OztXQUFBLENBQUMsQ0FBQyxFQUFFLFNBQU0sQ0FBQzs7Ozs7OztHQUNuRSxDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLGlDQUFpQyxFQUFFOzs7OzsyQ0FDOUIsTUFBTSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQzs7OzsyQ0FDL0IsTUFBTSxDQUFDLFlBQVkseUNBQXlDOzs7MkJBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRzs7Ozs7OztHQUN6RixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLDZDQUE2QyxFQUFFOzs7Ozs7OzJDQUMxQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDOzs7QUFDckMsZ0JBQU0sQ0FBQzs7Ozs7bURBQWtCLE1BQU0sQ0FBQyxZQUFZLGdCQUFnQjs7Ozs7Ozs7OztXQUFBLENBQUMsQ0FBQyxFQUFFLFNBQU0sQ0FBQzs7Ozs7OztHQUN4RSxDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvc2FmYXJpL3dlYnZpZXcvZXhlY3V0ZS1hc3luYy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbHMgZXhwZWN0ICovXG5pbXBvcnQgZGVzaXJlZCBmcm9tICcuL2Rlc2lyZWQnO1xuaW1wb3J0IHNldHVwIGZyb20gJy4uLy4uL3NldHVwLWJhc2UnO1xuaW1wb3J0IHsgbG9hZFdlYlZpZXcgfSBmcm9tICcuLi8uLi9oZWxwZXJzL3dlYnZpZXcnO1xuXG5kZXNjcmliZSgnc2FmYXJpIC0gd2VidmlldyAtIGV4ZWN1dGVBc3luYycsIGZ1bmN0aW9uKCkge1xuICBjb25zdCBkcml2ZXIgPSBzZXR1cCh0aGlzLCBkZXNpcmVkLCB7J25vLXJlc2V0JzogdHJ1ZX0sIGZhbHNlLCB0cnVlKS5kcml2ZXI7XG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4gYXdhaXQgbG9hZFdlYlZpZXcoZGVzaXJlZCwgZHJpdmVyKSk7XG5cbiAgaXQoJ3Nob3VsZCBidWJibGUgdXAgamF2YXNjcmlwdCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgZXhwZWN0KGFzeW5jICgpID0+IGF3YWl0IGRyaXZlci5leGVjdXRlQXN5bmMoYCduYW4nLS1gKSkudG8udGhyb3c7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZXhlY3V0ZSBhc3luYyBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGRyaXZlci5hc3luY1NjcmlwdFRpbWVvdXQoMTAwMDApO1xuICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZUFzeW5jKGBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdKDEyMyk7YCkpLnNob3VsZC5iZS5lcXVhbCgxMjMpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRpbWVvdXQgd2hlbiBjYWxsYmFjayBpcyBub3QgaW52b2tlZCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkcml2ZXIuYXN5bmNTY3JpcHRUaW1lb3V0KDQwMDApO1xuICAgIGV4cGVjdChhc3luYyAoKSA9PiBhd2FpdCBkcml2ZXIuZXhlY3V0ZUFzeW5jKGByZXR1cm4gMSArIDJgKSkudG8udGhyb3c7XG4gIH0pO1xufSk7XG4iXX0=